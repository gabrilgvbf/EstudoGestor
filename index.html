<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BB Agente TI - Plano de Estudos Pro</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --azul-bb: #004aad;
      --verde: #28a745;
      --amarelo: #ffc107;
      --vermelho: #dc3545;
      --cinza: #6c757d;
      --fundo: #f8f9fa;
      --card: #ffffff;
      --borda: #dee2e6;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Inter', sans-serif;
      background: var(--fundo);
      color: #212529;
      line-height: 1.6;
      padding: 20px;
    }

    .container { max-width: 1100px; margin: auto; }

    header {
      text-align: center;
      padding: 30px 20px;
      background: linear-gradient(135deg, var(--azul-bb), #003d82);
      color: white;
      border-radius: 16px;
      margin-bottom: 25px;
      box-shadow: 0 8px 20px rgba(0, 77, 173, 0.2);
    }

    header h1 { font-size: 2rem; margin-bottom: 8px; }
    header p { opacity: 0.9; font-size: 1.1rem; }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 25px;
    }

    .stat-card {
      background: var(--card);
      padding: 18px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      text-align: center;
      border: 1px solid var(--borda);
    }

    .stat-card h3 { font-size: 0.9rem; color: var(--cinza); margin-bottom: 8px; }
    .stat-card p { font-size: 1.5rem; font-weight: 600; color: var(--azul-bb); }

    .controls {
      display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px; justify-content: center; align-items: center;
    }

    button, select {
      padding: 10px 16px;
      border: none;
      border-radius: 8px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 0.95rem;
    }

    select {
      background: white;
      border: 1px solid var(--borda);
      color: #333;
    }

    .btn-primary { background: var(--azul-bb); color: white; }
    .btn-success { background: var(--verde); color: white; }
    .btn-warning { background: var(--amarelo); color: #212529; }
    .btn-danger { background: var(--vermelho); color: white; }
    .btn-secondary { background: #6c757d; color: white; }

    button:hover { transform: translateY(-1px); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
    button:active { transform: translateY(0); }

    .materia {
      background: var(--card);
      border-radius: 12px;
      margin-bottom: 16px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      border: 1px solid var(--borda);
    }

    .materia-header {
      background: var(--azul-bb);
      color: white;
      padding: 16px 20px;
      font-weight: 600;
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
      user-select: none;
    }

    .materia-header .peso { font-size: 0.9rem; opacity: 0.9; }
    .materia-header .arrow { font-size: 1.3rem; transition: transform 0.2s; }

    .materia-content {
      padding: 0;
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.4s ease, padding 0.4s ease;
    }

    .materia-content.open {
      padding: 16px 20px;
      max-height: 1000px;
    }

    .topico-item {
      display: flex;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px dashed #e9ecef;
      flex-wrap: wrap;
      gap: 10px;
    }

    .topico-item:last-child { border-bottom: none; }

    .topico-text { flex: 1; font-size: 0.95rem; }

    .topico-actions { display: flex; gap: 6px; }

    .btn-small {
      padding: 6px 10px;
      font-size: 0.8rem;
    }

    .status {
      width: 12px; height: 12px; border-radius: 50%; margin-right: 10px;
      border: 2px solid #ccc;
    }

    .status.pendente { background: #f8d7da; border-color: var(--vermelho); }
    .status.andamento { background: #fff3cd; border-color: var(--amarelo); }
    .status.concluido { background: #d4edda; border-color: var(--verde); }

    .pomodoro {
      text-align: center;
      padding: 20px;
      background: var(--card);
      border-radius: 12px;
      margin: 20px 0;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      display: none;
    }

    #timer { font-size: 3rem; font-weight: bold; color: var(--azul-bb); }

    .historico table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      font-size: 0.9rem;
    }

    .historico th, .historico td {
      padding: 10px;
      text-align: center;
      border: 1px solid var(--borda);
    }

    .historico th { background: var(--azul-bb); color: white; }
    .concluido { background: #d4edda; }
    .andamento { background: #fff3cd; }

    .modal {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.6);
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .modal-content {
      background: white;
      padding: 25px;
      border-radius: 12px;
      width: 90%;
      max-width: 500px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }

    textarea { width: 100%; height: 100px; padding: 10px; border: 1px solid var(--borda); border-radius: 8px; margin: 10px 0; }

    #cicloResult {
      margin: 20px 0;
      padding: 15px;
      background: #e7f3ff;
      border-radius: 8px;
      display: none;
      border: 1px solid #b3e0ff;
    }

    @media (max-width: 768px) {
      header h1 { font-size: 1.6rem; }
      .topico-item { flex-direction: column; align-items: flex-start; }
      .topico-actions { width: 100%; justify-content: flex-end; }
    }
  </style>
</head>
<body>

<div class="container">
  <header>
    <h1>Plano de Estudos BB - Agente TI</h1>
    <p>Concurso 2025/2026 | Estratégia + Disciplina = Aprovação</p>
  </header>

  <!-- Estatísticas -->
  <div class="stats-grid">
    <div class="stat-card">
      <h3>Tempo Hoje</h3>
      <p><span id="tempoHoje">0</span> min</p>
    </div>
    <div class="stat-card">
      <h3>Tempo Semana</h3>
      <p><span id="tempoSemana">0</span> min</p>
    </div>
    <div class="stat-card">
      <h3>Tópicos Concluídos</h3>
      <p><span id="topicosConcluidos">0</span></p>
    </div>
    <div class="stat-card">
      <h3>Progresso Geral</h3>
      <p><span id="progressoGeral">0</span>%</p>
    </div>
  </div>

  <!-- Controles -->
  <div class="controls">
    <select id="cicloTempo">
      <option value="15">15 min</option>
      <option value="30" selected>30 min</option>
      <option value="60">60 min</option>
      <option value="90">90 min</option>
      <option value="180">180 min</option>
    </select>
    <button class="btn-primary" onclick="gerarCiclo()">Gerar Ciclo</button>
    <button class="btn-success" onclick="iniciarPomodoro()">Pomodoro</button>
    <button class="btn-warning" onclick="pausaPomodoro()">Pausa</button>
    <button class="btn-danger" onclick="resetHistorico()">Resetar</button>
    <button class="btn-secondary" onclick="exportarPDF()">Exportar PDF</button>
  </div>

  <div class="pomodoro" id="pomodoroSection">
    <h3>Pomodoro Ativo</h3>
    <div id="timer">25:00</div>
    <button class="btn-success" onclick="iniciarPomodoro()">Iniciar</button>
    <button class="btn-warning" onclick="pausaPomodoro()">Pausar</button>
    <button class="btn-danger" onclick="pararPomodoro()">Parar</button>
  </div>

  <div id="cicloResult"></div>

  <!-- Matérias -->
  <div id="materias"></div>

  <!-- Histórico -->
  <div class="historico">
    <h2>Histórico de Estudo</h2>
    <table>
      <thead>
        <tr>
          <th>Matéria</th><th>Tópico</th><th>Início</th><th>Fim</th><th>Duração</th><th>Status</th>
        </tr>
      </thead>
      <tbody id="tabelaHistorico"></tbody>
    </table>
  </div>
</div>

<!-- Modal de Nota -->
<div class="modal" id="notaModal">
  <div class="modal-content">
    <h3>Notas do Tópico</h3>
    <textarea id="notaText" placeholder="Suas anotações, links, dúvidas..."></textarea>
    <div style="text-align:right; margin-top:10px;">
      <button class="btn-secondary" onclick="fecharModal()">Cancelar</button>
      <button class="btn-primary" onclick="salvarNota()">Salvar</button>
    </div>
  </div>
</div>

<script>
// === DADOS ===
const materias = [
  {nome:'LÍNGUA PORTUGUESA',topicos:['Compreensão de textos','Ortografia oficial','Classe e emprego de palavras','Emprego do acento indicativo de crase','Sintaxe da oração e do período','Emprego dos sinais de pontuação','Concordância verbal e nominal','Regência verbal e nominal','Colocação dos pronomes oblíquos átonos'],peso:2},
  {nome:'LÍNGUA INGLESA',topicos:['Vocabulário fundamental','Aspectos gramaticais básicos'],peso:1},
  {nome:'MATEMÁTICA',topicos:['Números inteiros, racionais e reais','Sistema legal de medidas','Razões e proporções','Lógica proposicional','Noções de conjuntos','Relações e funções','Matrizes','Determinantes','Sistemas lineares','Sequências','Progressões aritméticas e geométricas'],peso:2},
  {nome:'ATUALIDADES DO MERCADO FINANCEIRO',topicos:['Bancos na Era Digital','Internet banking e Mobile banking','Open banking','Fintechs, startups e big techs','Shadow banking','Blockchain e criptomoedas','PIX e arranjos de pagamento','Transformação digital no sistema financeiro'],peso:1},
  {nome:'PROBABILIDADE E ESTATÍSTICA',topicos:['Representação tabular e gráfica','Medidas de tendência central e dispersão','Variáveis aleatórias e distribuições','Teorema de Bayes e probabilidade condicional','Distribuição binomial e normal','Noções de amostragem e inferência estatística'],peso:1},
  {nome:'CONHECIMENTOS BANCÁRIOS',topicos:['Sistema Financeiro Nacional','Mercado financeiro','Política monetária e SELIC','Orçamento público e dívida pública','Produtos bancários','Mercado de câmbio','Taxas de juros e curva de juros','Lavagem de dinheiro e LGPD','Segurança cibernética e responsabilidade socioambiental'],peso:2},
  {nome:'TECNOLOGIA DA INFORMAÇÃO',topicos:['Aprendizagem de máquina','Banco de dados SQL e NoSQL','Big Data','Desenvolvimento Mobile','Estrutura de dados e algoritmos','Ferramentas e linguagens para dados'],peso:3}
];

let historico = JSON.parse(localStorage.getItem('bb-historico-v4')) || [];
let timerInterval = null;
let pomodoroTime = 25 * 60;

// === FUNÇÕES PRINCIPAIS ===
function salvar() {
  localStorage.setItem('bb-historico-v4', JSON.stringify(historico));
  atualizarTudo();
}

function atualizarTudo() {
  atualizarTabela();
  atualizarEstatisticas();
  renderizarMaterias();
}

// === ATUALIZAÇÕES ===
function atualizarTabela() {
  const tbody = document.getElementById('tabelaHistorico');
  tbody.innerHTML = '';
  historico.forEach(h => {
    const duracao = h.fim ? Math.round((new Date(h.fim) - new Date(h.inicio)) / 60000) + ' min' : '-';
    const tr = document.createElement('tr');
    tr.className = h.status === 'Concluído' ? 'concluido' : h.status === 'Em andamento' ? 'andamento' : '';
    tr.innerHTML = `<td>${h.materia}</td><td>${h.topico}</td><td>${formatarHora(h.inicio)}</td><td>${h.fim ? formatarHora(h.fim) : '-'}</td><td>${duracao}</td><td>${h.status}</td>`;
    tbody.appendChild(tr);
  });
}

function atualizarEstatisticas() {
  const hoje = new Date().toISOString().slice(0,10);
  let tempoHoje = 0, tempoSemana = 0, concluidos = 0, totalPesoConcluido = 0, totalPeso = 0;

  const inicioSemana = new Date();
  inicioSemana.setDate(inicioSemana.getDate() - inicioSemana.getDay() + 1);
  inicioSemana.setHours(0,0,0,0);

  materias.forEach(m => totalPeso += m.peso * m.topicos.length);

  historico.forEach(h => {
    if (h.fim) {
      const inicio = new Date(h.inicio);
      const fim = new Date(h.fim);
      const mins = Math.round((fim - inicio) / 60000);
      if (h.inicio.slice(0,10) === hoje) tempoHoje += mins;
      if (inicio >= inicioSemana) tempoSemana += mins;
      if (h.status === 'Concluído') {
        concluidos++;
        const materia = materias.find(m => m.nome === h.materia);
        if (materia) totalPesoConcluido += materia.peso;
      }
    }
  });

  const progresso = totalPeso > 0 ? Math.round((totalPesoConcluido / totalPeso) * 100) : 0;

  document.getElementById('tempoHoje').textContent = tempoHoje;
  document.getElementById('tempoSemana').textContent = tempoSemana;
  document.getElementById('topicosConcluidos').textContent = concluidos;
  document.getElementById('progressoGeral').textContent = progresso;
}

function renderizarMaterias() {
  const container = document.getElementById('materias');
  container.innerHTML = '';
  materias.forEach(m => {
    const div = document.createElement('div');
    div.className = 'materia';
    const concluidoCount = m.topicos.filter(t => 
      historico.some(h => h.materia === m.nome && h.topico === t && h.status === 'Concluído')
    ).length;

    div.innerHTML = `
      <div class="materia-header" onclick="toggleMateria(this)">
        <div>
          ${m.nome} <span class="peso">(Peso: ${m.peso})</span>
          <small style="opacity:0.8; margin-left:8px;">${concluidoCount}/${m.topicos.length}</small>
        </div>
        <span class="arrow">Down Arrow</span>
      </div>
      <div class="materia-content">
        ${m.topicos.map(t => {
          const reg = historico.find(h => h.materia === m.nome && h.topico === t);
          const status = reg?.status || 'Pendente';
          const statusClass = status === 'Concluído' ? 'concluido' : status === 'Em andamento' ? 'andamento' : 'pendente';
          const nota = reg?.nota || '';
          return `
            <div class="topico-item">
              <div class="status ${statusClass}"></div>
              <div class="topico-text">${t}</div>
              <div class="topico-actions">
                ${!reg?.inicio ? `<button class="btn-success btn-small" onclick="iniciar('${m.nome}','${t}')">Iniciar</button>` : ''}
                ${reg?.inicio && !reg?.fim ? `<button class="btn-warning btn-small" onclick="finalizar('${m.nome}','${t}')">Finalizar</button>` : ''}
                <button class="btn-secondary btn-small" onclick="abrirNota('${m.nome}','${t}','${nota.replace(/'/g, "\\'")}')">Note</button>
              </div>
            </div>
          `;
        }).join('')}
      </div>
    `;
    container.appendChild(div);
  });
}

function toggleMateria(header) {
  const content = header.nextElementSibling;
  const arrow = header.querySelector('.arrow');
  const isOpen = content.classList.contains('open');
  content.classList.toggle('open');
  arrow.textContent = isOpen ? 'Down Arrow' : 'Up Arrow';
}

// === AÇÕES ===
function iniciar(materia, topico) {
  if (historico.some(h => h.materia === materia && h.topico === topico && !h.fim)) {
    alert('Já em andamento!');
    return;
  }
  historico.push({ materia, topico, inicio: new Date().toISOString(), fim: null, status: 'Em andamento', nota: '' });
  salvar();
}

function finalizar(materia, topico) {
  const reg = historico.find(h => h.materia === materia && h.topico === topico && !h.fim);
  if (!reg) { alert('Não iniciado!'); return; }
  reg.fim = new Date().toISOString();
  reg.status = 'Concluído';
  salvar();
}

// === NOTAS ===
let notaAtual = {};
function abrirNota(materia, topico, nota) {
  notaAtual = { materia, topico };
  document.getElementById('notaText').value = nota;
  document.getElementById('notaModal').style.display = 'flex';
}

function salvarNota() {
  const nota = document.getElementById('notaText').value;
  const reg = historico.find(h => h.materia === notaAtual.materia && h.topico === notaAtual.topico);
  if (reg) reg.nota = nota;
  salvar();
  fecharModal();
}

function fecharModal() {
  document.getElementById('notaModal').style.display = 'none';
}

// === CICLO DE ESTUDO INTELIGENTE ===
function gerarCiclo() {
  const tempoTotal = parseInt(document.getElementById('cicloTempo').value) || 60;
  const agora = new Date();
  const umDiaAtras = new Date(agora.getTime() - 24 * 60 * 60 * 1000);

  const itensCiclo = [];

  historico.forEach(h => {
    if (h.inicio) {
      const materia = materias.find(m => m.nome === h.materia);
      if (!materia) return;

      const topicoObj = { materia: h.materia, topico: h.topico, peso: materia.peso };

      if (!h.fim) {
        itensCiclo.push({ ...topicoObj, tipo: 'Estudo', urgencia: 3 });
      } else if (new Date(h.fim) <= umDiaAtras) {
        itensCiclo.push({ ...topicoObj, tipo: 'Revisão', urgencia: 2 });
      }
    }
  });

  itensCiclo.sort((a, b) => b.urgencia - a.urgencia || b.peso - a.peso);

  const totalUrgenciaPeso = itensCiclo.reduce((s, i) => s + i.peso * i.urgencia, 0);
  let html = `<h3 style="margin-bottom:12px; color:#004aad;">Ciclo de Estudo (${tempoTotal} min)</h3>`;

  if (itensCiclo.length === 0) {
    html += `<p style="color:#28a745; font-weight:500;">Nenhum tópico iniciado. Comece um!</p>`;
  } else {
    html += `<ul style="padding-left:20px; line-height:1.7;">`;
    itensCiclo.forEach(item => {
      const proporcao = totalUrgenciaPeso > 0 ? (item.peso * item.urgencia) / totalUrgenciaPeso : 0;
      const minutos = Math.max(3, Math.round(proporcao * tempoTotal));
      const badge = item.tipo === 'Revisão' 
        ? `<span style="background:#fff3cd; color:#856404; padding:2px 6px; border-radius:4px; font-size:0.8rem; margin-left:6px;">Revisão</span>`
        : `<span style="background:#d4edda; color:#155724; padding:2px 6px; border-radius:4px; font-size:0.8rem; margin-left:6px;">Estudo</span>`;
      html += `<li><strong>${item.materia}</strong> → ${item.topico} ${badge}: <strong>${minutos} min</strong></li>`;
    });
    html += `</ul>`;
  }

  const result = document.getElementById('cicloResult');
  result.innerHTML = html;
  result.style.display = 'block';
}

// === POMODORO ===
function iniciarPomodoro() {
  document.getElementById('pomodoroSection').style.display = 'block';
  pomodoroTime = 25 * 60;
  atualizarTimer();
  timerInterval = setInterval(() => {
    if (pomodoroTime > 0) {
      pomodoroTime--;
      atualizarTimer();
    } else {
      clearInterval(timerInterval);
      alert('Pomodoro concluído! 5 min de pausa!');
    }
  }, 1000);
}

function pausaPomodoro() { clearInterval(timerInterval); }
function pararPomodoro() {
  clearInterval(timerInterval);
  document.getElementById('pomodoroSection').style.display = 'none';
}

function atualizarTimer() {
  const mins = String(Math.floor(pomodoroTime / 60)).padStart(2, '0');
  const secs = String(pomodoroTime % 60).padStart(2, '0');
  document.getElementById('timer').textContent = `${mins}:${secs}`;
}

// === UTILS ===
function formatarHora(iso) {
  return new Date(iso).toLocaleString('pt-BR', { hour: '2-digit', minute: '2-digit', day: '2-digit', month: '2-digit' });
}

function resetHistorico() {
  if (confirm('Resetar TODO o histórico?')) {
    historico = [];
    salvar();
  }
}

function exportarPDF() {
  window.print();
}

// === INICIALIZAÇÃO ===
atualizarTudo();
</script>

</body>
</html>