<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BB Agente TI - Ciclo com Timer</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --azul-bb: #004aad;
      --verde: #28a745;
      --amarelo: #ffc107;
      --vermelho: #dc3545;
      --cinza: #6c757d;
      --fundo: #f8f9fa;
      --card: #ffffff;
      --borda: #dee2e6;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Inter', sans-serif;
      background: var(--fundo);
      color: #212529;
      line-height: 1.6;
      padding: 20px;
    }

    .container { max-width: 1100px; margin: auto; }

    header {
      text-align: center;
      padding: 30px 20px;
      background: linear-gradient(135deg, var(--azul-bb), #003d82);
      color: white;
      border-radius: 16px;
      margin-bottom: 25px;
      box-shadow: 0 8px 20px rgba(0, 77, 173, 0.2);
    }

    header h1 { font-size: 2rem; margin-bottom: 8px; }
    header p { opacity: 0.9; font-size: 1.1rem; }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 25px;
    }

    .stat-card {
      background: var(--card);
      padding: 18px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      text-align: center;
      border: 1px solid var(--borda);
    }

    .stat-card h3 { font-size: 0.9rem; color: var(--cinza); margin-bottom: 8px; }
    .stat-card p { font-size: 1.5rem; font-weight: 600; color: var(--azul-bb); }

    .controls {
      display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px; justify-content: center; align-items: center;
    }

    button, select {
      padding: 10px 16px;
      border: none;
      border-radius: 8px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 0.95rem;
    }

    select {
      background: white;
      border: 1px solid var(--borda);
      color: #333;
    }

    .btn-primary { background: var(--azul-bb); color: white; }
    .btn-success { background: var(--verde); color: white; }
    .btn-warning { background: var(--amarelo); color: #212529; }
    .btn-danger { background: var(--vermelho); color: white; }
    .btn-secondary { background: #6c757d; color: white; }

    button:hover { transform: translateY(-1px); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }

    .ciclo-ativo {
      background: #e3f2fd;
      padding: 20px;
      border-radius: 12px;
      margin: 20px 0;
      border: 2px solid var(--azul-bb);
      display: none;
    }

    .ciclo-timer {
      font-size: 2.5rem;
      font-weight: bold;
      text-align: center;
      color: var(--azul-bb);
      margin: 15px 0;
    }

    .ciclo-progress {
      height: 10px;
      background: #ddd;
      border-radius: 5px;
      overflow: hidden;
      margin: 15px 0;
    }

    .ciclo-progress-fill {
      height: 100%;
      background: var(--verde);
      width: 0%;
      transition: width 0.3s ease;
    }

    .ciclo-info {
      display: flex;
      justify-content: space-between;
      font-size: 0.95rem;
      color: #555;
    }

    #cicloResult { display: none; }

    .materia, .historico { margin-top: 20px; }
  </style>
</head>
<body>

<div class="container">
  <header>
    <h1>Plano de Estudos BB - Agente TI</h1>
    <p>Concurso 2025/2026 | Ciclo com Timer Sequencial</p>
  </header>

  <!-- Estatísticas -->
  <div class="stats-grid">
    <div class="stat-card">
      <h3>Tempo Hoje</h3>
      <p><span id="tempoHoje">0</span> min</p>
    </div>
    <div class="stat-card">
      <h3>Tempo Semana</h3>
      <p><span id="tempoSemana">0</span> min</p>
    </div>
    <div class="stat-card">
      <h3>Tópicos Concluídos</h3>
      <p><span id="topicosConcluidos">0</span></p>
    </div>
    <div class="stat-card">
      <h3>Progresso Geral</h3>
      <p><span id="progressoGeral">0</span>%</p>
    </div>
  </div>

  <!-- Controles -->
  <div class="controls">
    <select id="cicloTempo">
      <option value="15">15 min</option>
      <option value="30" selected>30 min</option>
      <option value="60">60 min</option>
      <option value="90">90 min</option>
      <option value="180">180 min</option>
    </select>
    <button class="btn-primary" onclick="gerarCiclo()">Gerar Ciclo</button>
    <button class="btn-success" onclick="iniciarPomodoro()">Pomodoro</button>
    <button class="btn-danger" onclick="resetarProgresso()">Resetar Progresso</button>
    <button class="btn-secondary" onclick="exportarPDF()">Exportar PDF</button>
  </div>

  <!-- Ciclo Ativo com Timer -->
  <div class="ciclo-ativo" id="cicloAtivo">
    <h3 id="cicloTitulo">Ciclo Iniciado</h3>
    <div class="ciclo-timer" id="timerCiclo">00:00</div>
    <div class="ciclo-progress"><div class="ciclo-progress-fill" id="progressFill"></div></div>
    <div class="ciclo-info">
      <span>Tópico: <strong id="topicoAtual">-</strong></span>
      <span>Progresso: <strong id="progressoTexto">0%</strong></span>
    </div>
    <div style="text-align:center; margin-top:15px;">
      <button class="btn-warning" onclick="pausarCiclo()">Pausar</button>
      <button class="btn-success" onclick="proximoTopico()" id="btnProximo" style="display:none;">Próximo</button>
      <button class="btn-danger" onclick="pararCiclo()">Parar Ciclo</button>
    </div>
  </div>

  <div id="cicloResult"></div>

  <!-- Matérias e Histórico (mesmo do anterior) -->
  <div id="materias"></div>

  <div class="historico">
    <h2>Histórico de Estudo</h2>
    <table>
      <thead>
        <tr>
          <th>Matéria</th><th>Tópico</th><th>Início</th><th>Fim</th><th>Duração</th><th>Status</th><th>Ação</th>
        </tr>
      </thead>
      <tbody id="tabelaHistorico"></tbody>
    </table>
  </div>
</div>

<script>
// === DADOS ===
const materias =  [
  {nome:'LÍNGUA PORTUGUESA',topicos:['Compreensão de textos','Ortografia oficial','Classe e emprego de palavras','Emprego do acento indicativo de crase','Sintaxe da oração e do período','Emprego dos sinais de pontuação','Concordância verbal e nominal','Regência verbal e nominal','Colocação dos pronomes oblíquos átonos'],peso:2},
  {nome:'LÍNGUA INGLESA',topicos:['Vocabulário fundamental','Aspectos gramaticais básicos'],peso:1},
  {nome:'MATEMÁTICA',topicos:['Números inteiros, racionais e reais','Sistema legal de medidas','Razões e proporções','Lógica proposicional','Noções de conjuntos','Relações e funções','Matrizes','Determinantes','Sistemas lineares','Sequências','Progressões aritméticas e geométricas'],peso:2},
  {nome:'ATUALIDADES DO MERCADO FINANCEIRO',topicos:['Bancos na Era Digital','Internet banking e Mobile banking','Open banking','Fintechs, startups e big techs','Shadow banking','Blockchain e criptomoedas','PIX e arranjos de pagamento','Transformação digital no sistema financeiro'],peso:1},
  {nome:'PROBABILIDADE E ESTATÍSTICA',topicos:['Representação tabular e gráfica','Medidas de tendência central e dispersão','Variáveis aleatórias e distribuições','Teorema de Bayes e probabilidade condicional','Distribuição binomial e normal','Noções de amostragem e inferência estatística'],peso:1},
  {nome:'CONHECIMENTOS BANCÁRIOS',topicos:['Sistema Financeiro Nacional','Mercado financeiro','Política monetária e SELIC','Orçamento público e dívida pública','Produtos bancários','Mercado de câmbio','Taxas de juros e curva de juros','Lavagem de dinheiro e LGPD','Segurança cibernética e responsabilidade socioambiental'],peso:2},
  {nome:'TECNOLOGIA DA INFORMAÇÃO',topicos:['Aprendizagem de máquina','Banco de dados SQL e NoSQL','Big Data','Desenvolvimento Mobile','Estrutura de dados e algoritmos','Ferramentas e linguagens para dados'],peso:3}
];

let historico = JSON.parse(localStorage.getItem('bb-historico-v6')) || [];
let cicloAtual = [];
let indiceAtual = 0;
let timerCiclo = null;
let tempoRestante = 0;
let cicloPausado = false;

// === FUNÇÕES PRINCIPAIS ===
function salvar() {
  localStorage.setItem('bb-historico-v6', JSON.stringify(historico));
  atualizarTudo();
}

function atualizarTudo() {
  atualizarTabela();
  atualizarEstatisticas();
  renderizarMaterias();
}

// === GERAR CICLO + INICIAR TIMER ===
function gerarCiclo() {
  const tempoTotal = parseInt(document.getElementById('cicloTempo').value) || 60;
  const agora = new Date();
  const umDiaAtras = new Date(agora.getTime() - 24 * 60 * 60 * 1000);

  cicloAtual = [];

  historico.forEach(h => {
    if (h.inicio) {
      const materia = materias.find(m => m.nome === h.materia);
      if (!materia) return;

      const topicoObj = { materia: h.materia, topico: h.topico, peso: materia.peso };

      if (!h.fim) {
        cicloAtual.push({ ...topicoObj, tipo: 'Estudo', urgencia: 3 });
      } else if (new Date(h.fim) <= umDiaAtras) {
        cicloAtual.push({ ...topicoObj, tipo: 'Revisão', urgencia: 2 });
      }
    }
  });

  if (cicloAtual.length === 0) {
    alert('Nenhum tópico iniciado para o ciclo!');
    return;
  }

  cicloAtual.sort((a, b) => b.urgencia - a.urgencia || b.peso - a.peso);

  const totalUrgenciaPeso = cicloAtual.reduce((s, i) => s + i.peso * i.urgencia, 0);
  cicloAtual.forEach(item => {
    const proporcao = (item.peso * item.urgencia) / totalUrgenciaPeso;
    item.minutos = Math.max(3, Math.round(proporcao * tempoTotal));
  });

  iniciarCiclo();
}

// === INICIAR CICLO ===
function iniciarCiclo() {
  indiceAtual = 0;
  document.getElementById('cicloAtivo').style.display = 'block';
  document.getElementById('btnProximo').style.display = 'none';
  atualizarCicloUI();
  iniciarTimerTopico();
}

// === INICIAR TIMER DO TÓPICO ATUAL ===
function iniciarTimerTopico() {
  if (indiceAtual >= cicloAtual.length) {
    finalizarCiclo();
    return;
  }

  const item = cicloAtual[indiceAtual];
  tempoRestante = item.minutos * 60;

  timerCiclo = setInterval(() => {
    if (!cicloPausado && tempoRestante > 0) {
      tempoRestante--;
      atualizarTimerDisplay();
      atualizarProgressoCiclo();
    } else if (tempoRestante <= 0) {
      clearInterval(timerCiclo);
      notificarFimTopico();
    }
  }, 1000);

  atualizarTimerDisplay();
}

// === NOTIFICAR FIM DO TÓPICO ===
function notificarFimTopico() {
  // Som
  const audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZ
  ');
  audio.play().catch(() => {});

  // Alerta
  alert(`Tempo esgotado!\n\nTópico: ${cicloAtual[indiceAtual].topico}\n\nClique em "Próximo" para continuar.`);

  document.getElementById('btnProximo').style.display = 'inline-block';
}

// === PRÓXIMO TÓPICO ===
function proximoTopico() {
  indiceAtual++;
  document.getElementById('btnProximo').style.display = 'none';
  if (indiceAtual < cicloAtual.length) {
    atualizarCicloUI();
    iniciarTimerTopico();
  } else {
    finalizarCiclo();
  }
}

// === PAUSAR/RETOMAR ===
function pausarCiclo() {
  cicloPausado = !cicloPausado;
  const btn = document.querySelector('#cicloAtivo .btn-warning');
  btn.textContent = cicloPausado ? 'Retomar' : 'Pausar';
}

// === PARAR CICLO ===
function pararCiclo() {
  clearInterval(timerCiclo);
  document.getElementById('cicloAtivo').style.display = 'none';
  cicloAtual = [];
  indiceAtual = 0;
}

// === FINALIZAR CICLO ===
function finalizarCiclo() {
  clearInterval(timerCiclo);
  alert('Ciclo concluído com sucesso!');
  document.getElementById('cicloAtivo').style.display = 'none';
  cicloAtual = [];
}

// === ATUALIZAR UI DO CICLO ===
function atualizarCicloUI() {
  const item = cicloAtual[indiceAtual];
  document.getElementById('cicloTitulo').textContent = `${item.tipo}: ${item.materia}`;
  document.getElementById('topicoAtual').textContent = `${item.topico} (${item.minutos} min)`;
  document.getElementById('progressoTexto').textContent = `${Math.round((indiceAtual / cicloAtual.length) * 100)}%`;
  document.getElementById('progressFill').style.width = `${(indiceAtual / cicloAtual.length) * 100}%`;
}

function atualizarTimerDisplay() {
  const mins = String(Math.floor(tempoRestante / 60)).padStart(2, '0');
  const secs = String(tempoRestante % 60).padStart(2, '0');
  document.getElementById('timerCiclo').textContent = `${mins}:${secs}`;
}

function atualizarProgressoCiclo() {
  const item = cicloAtual[indiceAtual];
  const progressoTopico = ((item.minutos * 60 - tempoRestante) / (item.minutos * 60)) * 100;
  const progressoTotal = ((indiceAtual * 100 + progressoTopico) / cicloAtual.length);
  document.getElementById('progressFill').style.width = `${progressoTotal}%`;
  document.getElementById('progressoTexto').textContent = `${Math.round(progressoTotal)}%`;
}

// === RESTANTE DO CÓDIGO (iniciar, finalizar, etc.) ===
function iniciar(materia, topico) { /* mesmo do anterior */ }
function finalizar(materia, topico) { /* mesmo do anterior */ }
function resetarProgresso() { /* mesmo do anterior */ }

// === INICIALIZAÇÃO ===
atualizarTudo();
</script>

</body>
</html>